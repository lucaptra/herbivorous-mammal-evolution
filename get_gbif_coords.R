# Purpose: Retrieve occurrence records of known herbivorous species using rgbif library

# Set working directory
setwd("/Users/lucy/Desktop/spatial data/manuscript_seasonality")

# Load libraries
library(maptools)
library(raster)
library(rgbif)
library(rgdal)
library(rJava)
library(SDMTools)
library(sp)

# Create vector of known herbivorous species
herb <- c("Acerodon jubatus", "Acerodon mackloti", "Aconaemys fuscus", "Addax nasomaculatus", "Aepyceros melampus", "Ailuropoda melanoleuca", "Ailurops ursinus", "Ailurus fulgens", "Alcelaphus buselaphus", "Alcelaphus lichtensteinii", "Alces alces", "Alces americanus", "Alouatta caraya", "Alouatta guariba", "Alouatta palliata", "Alouatta pigra", "Alticola argentatus", "Ametrida centurio", "Ammospermophilus harrisii", "Ammotragus lervia", "Anisomys imitator", "Anomalurus derbianus", "Antidorcas marsupialis", "Antilocapra americana", "Antilope cervicapra", "Aotus vociferans", "Aplodontia rufa", "Aproteles bulmerae", "Arborimus albipes", "Arborimus longicaudus", "Arborimus pomo", "Arctictis binturong", "Ardops nichollsi", "Artibeus amplus", "Artibeus anderseni", "Artibeus aztecus", "Artibeus cinereus", "Artibeus concolor", "Artibeus fimbriatus", "Artibeus fraterculus", "Artibeus glaucus", "Artibeus hirsutus", "Artibeus inopinatus", "Artibeus lituratus", "Artibeus obscurus", "Artibeus toltecus", "Ateles belzebuth", "Ateles chamek", "Ateles fusciceps", "Ateles geoffroyi", "Ateles marginatus", "Avahi laniger", "Avahi occidentalis", "Axis kuhlii", "Axis porcinus", "Baiomys musculus", "Baiomys taylori", "Balionycteris maculata", "Bathyergus janetta", "Bathyergus suillus", "Beatragus hunteri", "Bison bison", "Bison bonasus", "Blastocerus dichotomus", "Bos frontalis", "Bos grunniens", "Bos javanicus", "Bos sauveli", "Boselaphus tragocamelus", "Brachylagus idahoensis", "Brachytarsomys albicauda", "Bradypus tridactylus", "Bradypus variegatus", "Bubalus bubalis", "Bubalus depressicornis", "Bubalus mindorensis", "Bubalus quarlesi", "Budorcas taxicolor", "Bunolagus monticularis", "Callicebus personatus", "Camelus bactrianus", "Camelus dromedarius", "Capra falconeri", "Capra hircus", "Capra ibex", "Capra pyrenaica", "Capricornis sumatraensis", "Caprolagus hispidus", "Carollia brevicauda", "Carollia castanea", "Carollia subrufa", "Casinycteris argynnis", "Castor canadensis", "Castor fiber", "Cavia aperea", "Centurio senex", "Cephalophus adersi", "Cephalophus callipygus", "Cephalophus jentinki", "Cephalophus natalensis", "Cephalophus nigrifrons", "Cephalophus spadix", "Ceratotherium simum", "Cercocebus galeritus", "Cercocebus torquatus", "Cercopithecus campbelli", "Cervus elaphus", "Cervus nippon", "Chaetodipus artus", "Chaetodipus fallax", "Chaetodipus hispidus", "Chaetodipus lineatus", "Chaetodipus pernix", "Chaetomys subspinosus", "Chinchilla chinchilla", "Chinchilla lanigera", "Chiroderma doriae", "Chiroderma improvisum", "Chiroderma salvini", "Chiroderma trinitatum", "Chiroderma villosum", "Chironax melanocephalus", "Chiropotes albinasus", "Chiropotes satanas", "Choloepus hoffmanni", "Coccymys ruemmleri", "Coendou bicolor", "Coendou prehensilis", "Coendou rothschildi", "Colobus angolensis", "Colobus guereza", "Colobus polykomos", "Colobus satanas", "Connochaetes gnou", "Connochaetes taurinus", "Cratogeomys castanops", "Cratogeomys fumosus", "Cratogeomys gymnurus", "Cratogeomys merriami", "Cratogeomys neglectus", "Cratogeomys tylorhinus", "Cratogeomys zinseri", "Cryptomys damarensis", "Cryptomys hottentotus", "Cryptomys mechowi", "Ctenodactylus vali", "Ctenomys argentinus", "Ctenomys australis", "Ctenomys azarae", "Ctenomys boliviensis", "Ctenomys bonettoi", "Ctenomys colburni", "Ctenomys coludo", "Ctenomys conoveri", "Ctenomys dorsalis", "Ctenomys emilianus", "Ctenomys famosus", "Ctenomys frater", "Ctenomys fulvus", "Ctenomys johannis", "Ctenomys knighti", "Ctenomys latro", "Ctenomys leucodon", "Ctenomys lewisi", "Ctenomys magellanicus", "Ctenomys maulinus", "Ctenomys mendocinus", "Ctenomys minutus", "Ctenomys occultus", "Ctenomys opimus", "Ctenomys pearsoni", "Ctenomys perrensi", "Ctenomys peruanus", "Ctenomys pontifex", "Ctenomys porteousi", "Ctenomys rionegrensis", "Ctenomys saltarius", "Ctenomys sericeus", "Ctenomys steinbachi", "Ctenomys talarum", "Ctenomys torquatus", "Ctenomys tuconax", "Ctenomys tucumanus", "Ctenomys tulduco", "Ctenomys validus", "Cuniculus paca", "Cuniculus taczanowskii", "Cynocephalus volans", "Cynomys leucurus", "Cynomys ludovicianus", "Cynomys mexicanus", "Cynomys parvidens", "Cynopterus brachyotis", "Cynopterus horsfieldii", "Cynopterus sphinx", "Dama dama", "Damaliscus lunatus", "Dasyprocta azarae", "Dasyprocta coibae", "Dasyprocta cristata", "Dasyprocta fuliginosa", "Dasyprocta guamara", "Dasyprocta kalinowskii", "Dasyprocta leporina", "Dasyprocta mexicana", "Dasyprocta prymnolopha", "Dasyprocta punctata", "Dasyprocta ruatanica", "Dendrohyrax arboreus", "Dendrohyrax dorsalis", "Dendrolagus goodfellowi", "Dendrolagus inustus", "Dendrolagus matschiei", "Dendrolagus scottae", "Dendrolagus spadix", "Dendrolagus ursinus", "Desmodillus auricularis", "Dicerorhinus sumatrensis", "Diceros bicornis", "Dinomys branickii", "Diplomys caniceps", "Diplomys labilis", "Diplomys rufodorsalis", "Dipodomys californicus", "Dipodomys deserti", "Dipodomys merriami", "Dipodomys nelsoni", "Dipodomys nitratoides", "Dipodomys phillipsii", "Dipodomys stephensi", "Dipodomys venustus", "Dobsonia minor", "Dobsonia moluccensis", "Dobsonia pannietensis", "Dobsonia peronii", "Dobsonia praedatrix", "Dolichotis patagonum", "Dolichotis salinicola", "Dorcatragus megalotis", "Dorcopsis luctuosa", "Dorcopsulus macleayi", "Dorcopsulus vanheurni", "Echimys chrysurus", "Echimys semivillosus", "Ectophylla alba", "Eidolon dupreanum", "Eidolon helvum", "Elaphurus davidianus", "Elephas maximus", "Eligmodontia typus", "Eliurus webbi", "Ellobius fuscocapillus", "Enchisthenes hartii", "Eonycteris major", "Epixerus ebii", "Epomophorus crypturus", "Epomophorus gambianus", "Epomophorus grandis", "Epomophorus labiatus", "Epomophorus minor", "Epomophorus wahlbergi", "Epomops buettikoferi", "Equus burchellii", "Equus caballus", "Equus grevyi", "Equus hemionus", "Equus zebra", "Erethizon dorsatum", "Erophylla bombifrons", "Eudorcas thomsonii", "Eulemur fulvus", "Eupetaurus cinereus", "Felovia vae", "Funisciurus anerythrus", "Funisciurus isabella", "Funisciurus pyrropus", "Galago alleni", "Galago moholi", "Galea flavidens", "Galea musteloides", "Galea spixii", "Galeopterus variegates", "Gazella gazella", "Gazella leptoceros", "Gazella subgutturosa", "Geocapromys brownii", "Geocapromys ingrahami", "Geomys arenarius", "Geomys attwateri", "Geomys breviceps", "Geomys bursarius", "Geomys knoxjonesi", "Geomys personatus", "Geomys pinetis", "Geomys tropicalis", "Gerbillus andersoni", "Gerbillus pyramidum", "Giraffa camelopardalis", "Golunda ellioti", "Gymnuromys roberti", "Haeromys pusillus", "Hapalemur aureus", "Hapalemur griseus", "Hapalomys longicaudatus", "Haplonycteris fischeri", "Harpyionycteris whiteheadi", "Helarctos malayanus", "Heliophobius argenteocinereus", "Heliosciurus rufobrachium", "Hemitragus hylocrius", "Hemitragus jayakari", "Hemitragus jemlahicus", "Heterocephalus glaber", "Heterohyrax brucei", "Heteromys australis", "Heteromys desmarestianus", "Heteromys gaumeri", "Heteromys nelsoni", "Heteromys oresterus", "Hexaprotodon liberiensis", "Hippocamelus antisensis", "Hippocamelus bisulcus", "Hippotragus equinus", "Hippotragus niger", "Holochilus brasiliensis", "Holochilus chacarius", "Hoplomys gymnurus", "Hydrochoerus hydrochaeris", "Hyemoschus aquaticus", "Hylochoerus meinertzhageni", "Hyomys dammermani", "Hyomys goliath", "Hypogeomys antimena", "Hypsignathus monstrosus", "Hystrix africaeaustralis", "Idiurus macrotis", "Indri indri", "Isthmomys flavidus", "Kannabateomys amblyonyx", "Kerodon rupestris", "Kobus ellipsiprymnus", "Kobus kob", "Kobus leche", "Kobus vardonii", "Kunsia fronto", "Lagidium peruanum", "Lagorchestes hirsutus", "Lagostomus maximus", "Lagostrophus fasciatus", "Lama glama", "Lariscus insignis", "Lasiorhinus krefftii", "Lasiorhinus latifrons", "Lemmiscus curtatus", "Lepilemur dorsalis", "Lepilemur leucopus", "Lepilemur mustelinus", "Lepilemur ruficaudatus", "Lepilemur septentrionalis", "Leporillus conditor", "Lepus alleni", "Lepus americanus", "Lepus arcticus", "Lepus californicus", "Lepus callotis", "Lepus capensis", "Lepus comus", "Lepus flavigularis", "Lepus microtis", "Lepus oiostolus", "Lepus othus", "Lepus townsendii", "Lepus yarkandensis", "Liomys pictus", "Lionycteris spurrelli", "Lissonycteris angolensis", "Litocranius walleri", "Loxodonta africana", "Loxodonta cyclotis", "Macaca arctoides", "Macaca mulatta", "Macaca nemestrina", "Macaca nigra", "Macaca sinica", "Macroglossus minimus", "Macroglossus sobrinus", "Macropus agilis", "Macropus giganteus", "Macropus parma", "Macropus parryi", "Macropus robustus", "Macropus rufus", "Macruromys elegans", "Macruromys major", "Madoqua guentheri", "Madoqua kirkii", "Madoqua piacentinii", "Madoqua saltiana", "Mallomys aroaensis", "Mallomys gunung", "Mallomys istapantap", "Mallomys rothschildi", "Mammelomys lanosus", "Mammelomys rattoides", "Marmota flaviventris", "Marmota marmota", "Marmota vancouverensis", "Massoutiera mzabi", "Mazama americana", "Mazama gouazoubira", "Megaerops ecaudatus", "Melomys leucogaster", "Melomys lutillus", "Melomys rufescens", "Melonycteris melanops", "Melonycteris woodfordi", "Meriones crassus", "Mesophylla macconnelli", "Microcavia australis", "Microcavia niata", "Micropteropus pusillus", "Microtus bavaricus", "Microtus breweri", "Microtus chrotorrhinus", "Microtus longicaudus", "Microtus oregoni", "Microtus pinetorum", "Microtus richardsoni", "Microtus townsendii", "Microtus xanthognathus", "Moschus berezovskii", "Moschus chrysogaster", "Moschus fuscus", "Moschus moschiferus", "Muntiacus atherodes", "Muntiacus muntjak", "Muntiacus reevesi", "Mus spicilegus", "Myoprocta acouchy", "Myotomys unisulcatus", "Naemorhedus goral", "Nandinia binotata", "Nanger dama", "Nanger granti", "Nasalis larvatus", "Neofiber alleni", "Neotoma albigula", "Neotoma cinerea", "Neotoma floridana", "Neotoma lepida", "Neotoma mexicana", "Neotoma micropus", "Neotoma phenax", "Neotragus batesi", "Neotragus moschatus", "Neotragus pygmaeus", "Nesokia indica", "Nesolagus netscheri", "Nesomys audeberti", "Nesomys rufus", "Nyctimene albiventer", "Nyctimene rabori", "Nyctimene robinsoni", "Nyctomys sumichrasti", "Ochotona cansus", "Ochotona collaris", "Ochotona curzoniae", "Ochotona dauurica", "Ochotona ladacensis", "Ochotona princeps", "Ochotona pusilla", "Ochotona rutila", "Octodon bridgesi", "Octodon lunatus", "Octodontomys gliroides", "Octomys mimax", "Odocoileus hemionus", "Odocoileus virginianus", "Oecomys bicolor", "Okapia johnstoni", "Onychogalea fraenata", "Oreamnos americanus", "Oreonax flavicauda", "Oreotragus oreotragus", "Orthogeomys cavator", "Orthogeomys cherriei", "Orthogeomys cuniculus", "Orthogeomys dariensis", "Orthogeomys grandis", "Orthogeomys heterodus", "Orthogeomys hispidus", "Orthogeomys lanius", "Orthogeomys matagalpae", "Orthogeomys thaeleri", "Orthogeomys underwoodi", "Oryctolagus cuniculus", "Oryx dammah", "Oryx gazella", "Oryx leucoryx", "Oryzomys subflavus", "Otomys angoniensis", "Otomys irroratus", "Ototylomys phyllotis", "Ourebia ourebi", "Ovibos moschatus", "Ovis ammon", "Ovis aries", "Ovis canadensis", "Ovis dalli", "Ozotoceros bezoarticus", "Papio cynocephalus", "Papio hamadryas", "Papio ursinus", "Pappogeomys alcorni", "Pappogeomys bulleri", "Paradipus ctenodactylus", "Paramelomys levipes", "Paramelomys lorentzii", "Paramelomys mollis", "Paramelomys moncktoni", "Paramelomys platyops", "Paramelomys rubex", "Paranyctimene raptor", "Paraxerus poensis", "Pecari tajacu", "Pectinator spekei", "Pedetes capensis", "Pelea capreolus", "Pentalagus furnessi", "Penthetor lucasi", "Perognathus fasciatus", "Perognathus flavescens", "Perognathus longimembris", "Peromyscus aztecus", "Peromyscus mexicanus", "Peromyscus pectoralis", "Peroryctes raffrayana", "Petaurista leucogenys", "Petauroides volans", "Petrogale persephone", "Petrogale xanthopus", "Petromus typicus", "Petropseudes dahli", "Phacochoerus aethiopicus", "Phacochoerus africanus", "Phalanger intercastellanus", "Phalanger lullulae", "Phalanger matanim", "Phalanger orientalis", "Phalanger ornatus", "Phalanger sericeus", "Phalanger vestitus", "Phascolarctos cinereus", "Phenacomys intermedius", "Phyllostomus elongatus", "Piliocolobus kirkii", "Piliocolobus preussi", "Piliocolobus rufomitratus", "Pithecia aequatorialis", "Pithecia pithecia", "Plagiodontia aedium", "Platalina genovensium", "Platyrrhinus helleri", "Platyrrhinus vittatus", "Pogonomys championi", "Pogonomys loriae", "Pogonomys macrourus", "Pogonomys sylvestris", "Potorous gilbertii", "Potorous longipes", "Presbytis comata", "Presbytis melalophos", "Presbytis rubicunda", "Procapra gutturosa", "Procavia capensis", "Procolobus verus", "Proechimys guairae", "Proechimys guyannensis", "Pronolagus crassicaudatus", "Pronolagus randensis", "Pronolagus rupestris", "Propithecus diadema", "Propithecus tattersalli", "Propithecus verreauxi", "Protochromys fellowsi", "Protoxerus stangeri", "Pseudocheirus peregrinus", "Pseudochirops albertisii", "Pseudochirops archeri", "Pseudochirops corinnae", "Pseudochirops coronatus", "Pseudochirops cupreus", "Pseudochirulus canescens", "Pseudochirulus caroli", "Pseudochirulus cinereus", "Pseudochirulus forbesi", "Pseudochirulus mayeri", "Pseudois nayaur", "Pseudomys delicatulus", "Pseudomys fieldi", "Pseudomys occidentalis", "Ptenochirus jagori", "Pteropus alecto", "Pteropus conspicillatus", "Pteropus giganteus", "Pteropus hypomelanus", "Pteropus insularis", "Pteropus lylei", "Pteropus mariannus", "Pteropus molossinus", "Pteropus poliocephalus", "Pteropus pumilus", "Pteropus rodricensis", "Pteropus samoensis", "Pteropus scapulatus", "Pteropus tonganus", "Pteropus vampyrus", "Pudu puda", "Pygathrix nemaeus", "Pygathrix nigripes", "Pygeretmus pumilio", "Pygoderma bilabiatum", "Rangifer tarandus", "Raphicerus campestris", "Raphicerus melanotis", "Raphicerus sharpei", "Rattus giluwensis", "Rattus mordax", "Rattus norvegicus", "Redunca arundinum", "Redunca fulvorufula", "Redunca redunca", "Reithrodon auritus", "Reithrodontomys raviventris", "Rhinoceros sondaicus", "Rhinoceros unicornis", "Rhinophylla alethina", "Rhinophylla fischerae", "Rhinophylla pumilio", "Rhinopithecus brelichi", "Rhinopithecus roxellana", "Romerolagus diazi", "Rousettus aegyptiacus", "Rousettus amplexicaudatus", "Rousettus madagascariensis", "Rucervus duvaucelii", "Rucervus eldii", "Rupicapra rupicapra", "Rusa timorensis", "Rusa unicolor", "Saiga tatarica", "Salpingotulus michaelis", "Sciurillus pusillus", "Sciurus arizonensis", "Sciurus aureogaster", "Sciurus colliaei", "Sciurus deppei", "Sciurus griseus", "Sciurus igniventris", "Sciurus nayaritensis", "Sciurus spadiceus", "Sciurus yucatanensis", "Semnopithecus entellus", "Setonix brachyurus", "Sigmodon alstoni", "Simias concolor", "Solomys ponceleti", "Solomys salamonis", "Solomys sapientis", "Spalacopus cyanus", "Spermophilus adocetus", "Spermophilus columbianus", "Spermophilus elegans", "Spermophilus mohavensis", "Spermophilus richardsonii", "Sphaeronycteris toxophyllum", "Sphiggurus mexicanus", "Spilocuscus maculatus", "Stenoderma rufum", "Strigocuscus pelengensis", "Sturnira aratathomasi", "Sturnira bidens", "Sturnira bogotensis", "Sturnira erythromos", "Sturnira ludovici", "Sturnira luisi", "Sturnira magna", "Sturnira mordax", "Sturnira nana", "Sturnira thomasi", "Sturnira tildae", "Stylodipus andrewsi", "Stylodipus sungorus", "Stylodipus telum", "Syconycteris australis", "Syconycteris carolinae", "Syconycteris hobbit", "Sylvicapra grimmia", "Sylvilagus aquaticus", "Sylvilagus audubonii", "Sylvilagus bachmani", "Sylvilagus brasiliensis", "Sylvilagus cunicularius", "Sylvilagus dicei", "Sylvilagus floridanus", "Sylvilagus nuttallii", "Sylvilagus palustris", "Sylvilagus transitionalis", "Synaptomys cooperi", "Syncerus caffer", "Syntheosciurus brochus", "Tachyoryctes macrocephalus", "Tamias alpinus", "Tamias dorsalis", "Tamias obscurus", "Tamias rufus", "Tamias sonomae", "Tapirus bairdii", "Tapirus indicus", "Tapirus pinchaque", "Tarsipes rostratus", "Tarsius syrichta", "Taterillus pygargus", "Taurotragus derbianus", "Taurotragus oryx", "Tetracerus quadricornis", "Theropithecus gelada", "Thomasomys aureus", "Thomomys bottae", "Thomomys bulbivorus", "Thomomys mazama", "Thomomys monticola", "Thomomys talpoides", "Thomomys townsendii", "Thomomys umbrinus", "Thryonomys swinderianus", "Thylogale stigmatica", "Trachypithecus delacouri", "Trachypithecus francoisi", "Trachypithecus johnii", "Trachypithecus obscurus", "Trachypithecus vetulus", "Tragelaphus angasii", "Tragelaphus buxtoni", "Tragelaphus eurycerus", "Tragelaphus imberbis", "Tragelaphus scriptus", "Tragelaphus spekii", "Tragelaphus strepsiceros", "Tragulus javanicus", "Tragulus napu", "Trichosurus arnhemensis", "Trichosurus caninus", "Trichosurus vulpecula", "Trogopterus xanthipes", "Tympanoctomys barrerae", "Uroderma magnirostrum", "Uromys anak", "Uromys hadrourus", "Ursus americanus", "Ursus thibetanus", "Vampyressa pusilla", "Vampyrodes caraccioli", "Varecia variegata", "Vicugna vicugna", "Vombatus ursinus", "Wallabia bicolor", "Wyulda squamicaudata", "Xerus inauris", "Xerus princeps", "Zygogeomys trichopus") # 771 species

gbif.search.list <- list()
gbif.search.df <- data.frame()

for (i in herb) {
	key <- name_backbone(name = i, kingdom = "animals")$speciesKey
	if (is.null(key) == FALSE) {
		gbif.search <- occ_search(taxonKey = key, limit = 1000, hasCoordinate = TRUE, spatialIssues = FALSE, fields = c("name", "key", "order", "family", "basisOfRecord", "country", "elevation", "decimalLatitude", "decimalLongitude", "http...rs.tdwg.org.dwc.terms.geodeticDatum"), return = "data")
		if (gbif.search != "no data found, try a different search") {
			gbif.search.df <- rbind(gbif.search.df, cbind(gbif.search$name, gbif.search$key, gbif.search$order, gbif.search$family, gbif.search$basisOfRecord, gbif.search$country, gbif.search$decimalLatitude, gbif.search$decimalLongitude))
			gbif.search.list <- c(gbif.search.list, gbif.search)}}
	print(paste(which(herb == i), i, sep = " "))}

names(gbif.search.df) <- c("name", "key", "order", "family", "basisOfRecord", "country", "decimalLatitude", "decimalLongitude")

save(gbif.search.df, gbif.search.list, file = "rgbif.herbsp.occ.search.052714.out")